{% if metrics_df is defined and metrics_df is not none %}
<div class="space-y-6">
    <!-- Portfolio & Benchmark Metrics -->
    <div>
        <h3 class="text-lg font-semibold mb-4">포트폴리오 & 벤치마크 메트릭</h3>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
            <div class="bg-gray-50 p-4 rounded">
                <p class="text-sm text-gray-600">포트폴리오 CAGR</p>
                <p class="text-xl font-bold">{{ "%.2f%%"|format(portfolio_metrics.cagr * 100) }}</p>
            </div>
            <div class="bg-gray-50 p-4 rounded">
                <p class="text-sm text-gray-600">포트폴리오 변동성</p>
                <p class="text-xl font-bold">{{ "%.2f%%"|format(portfolio_metrics.volatility * 100) }}</p>
            </div>
            <div class="bg-gray-50 p-4 rounded">
                <p class="text-sm text-gray-600">포트폴리오 샤프</p>
                <p class="text-xl font-bold">{{ "%.2f"|format(portfolio_metrics.sharpe) }}</p>
            </div>
            <div class="bg-gray-50 p-4 rounded">
                <p class="text-sm text-gray-600">포트폴리오 최대낙폭</p>
                <p class="text-xl font-bold">{{ "%.2f%%"|format(portfolio_metrics.max_drawdown * 100) }}</p>
            </div>
        </div>

        {% if benchmark_metrics %}
        <div class="grid grid-cols-3 gap-4">
            <div class="bg-gray-50 p-4 rounded">
                <p class="text-sm text-gray-600">벤치마크 CAGR</p>
                <p class="text-xl font-bold">{{ "%.2f%%"|format(benchmark_metrics.cagr * 100) }}</p>
            </div>
            <div class="bg-gray-50 p-4 rounded">
                <p class="text-sm text-gray-600">벤치마크 변동성</p>
                <p class="text-xl font-bold">{{ "%.2f%%"|format(benchmark_metrics.volatility * 100) }}</p>
            </div>
            <div class="bg-gray-50 p-4 rounded">
                <p class="text-sm text-gray-600">벤치마크 샤프</p>
                <p class="text-xl font-bold">{{ "%.2f"|format(benchmark_metrics.sharpe) }}</p>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Asset Metrics Table -->
    <div>
        <h3 class="text-lg font-semibold mb-4">보강된 데이터 (자산별)</h3>
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">티커</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">CAGR</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">변동성</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">샤프</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">최대낙폭</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">IR</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">E</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">E′</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">위험기여도</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">가중치</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% for row in metrics_df %}
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">{{ row.ticker }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm">{{ "%.2f%%"|format(row.CAGR * 100) if row.CAGR == row.CAGR else "-" }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm">{{ "%.2f%%"|format(row.변동성 * 100) if row.변동성 == row.변동성 else "-" }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm">{{ "%.2f"|format(row.샤프) if row.샤프 == row.샤프 else "-" }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm">{{ "%.2f%%"|format(row.최대낙폭 * 100) if row.최대낙폭 == row.최대낙폭 else "-" }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm">{{ "%.2f"|format(row.IR) if row.IR == row.IR else "-" }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm">{{ "%.2f"|format(row.E) if row.E == row.E else "-" }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm">{{ "%.2f"|format(row.get('E′', row.get('E_prime', None))) if row.get('E′', row.get('E_prime', None)) == row.get('E′', row.get('E_prime', None)) else "-" }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm">{{ "%.2f%%"|format(row.위험기여도 * 100) if row.위험기여도 == row.위험기여도 else "-" }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm">{{ "%.2f%%"|format(row.가중치 * 100) if row.가중치 == row.가중치 else "-" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    {% if missing_tickers %}
    <div class="bg-yellow-50 border border-yellow-200 text-yellow-800 px-4 py-3 rounded">
        <p class="text-sm font-medium">⚠️ 경고</p>
        <p class="text-sm mt-1">다음 티커에 대한 가격 데이터가 없습니다: {{ missing_tickers|join(", ") }}</p>
    </div>
    {% endif %}
</div>

<script>
// Enable evaluation button after analysis
document.getElementById('run_evaluation_btn').disabled = false;
</script>
{% else %}
<p class="text-gray-500 text-sm">분석 결과가 없습니다.</p>
{% endif %}
